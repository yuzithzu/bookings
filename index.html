<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>üì¶ Booking App</title>
<style>
* { box-sizing: border-box; font-family: 'Poppins', sans-serif; }
body { margin: 0; display: flex; height: 100vh; background: #f4f6f9; }
.sidebar {
  width: 230px; background: var(--sidebar-color, #0d6efd); color: white;
  display: flex; flex-direction: column; align-items: center; padding: 20px 0;
}
.sidebar h2 { font-size: 20px; margin-bottom: 40px; }
.nav-item { width: 100%; text-align: center; padding: 12px 0; cursor: pointer; transition: 0.2s; }
.nav-item:hover, .nav-item.active { background: rgba(255,255,255,0.15); }
.main { flex: 1; padding: 30px; overflow-y: auto; }
h1 { color: var(--main-color, #0d6efd); text-align: center; margin-bottom: 20px; }
form {
  background: #fff; padding: 20px; border-radius: 12px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.1); max-width: 900px; margin: auto;
}
label { font-weight: 600; margin-top: 10px; display: block; }
input, textarea, select {
  width: 100%; padding: 8px; margin-top: 6px;
  border: 1px solid #ccc; border-radius: 8px; font-size: 14px;
}
input:focus, textarea:focus, select:focus { border-color: var(--main-color, #0d6efd); outline: none; }
.btn {
  width: 100%; background: var(--btn-color, #0d6efd); color: white; border: none;
  border-radius: 8px; padding: 10px; font-size: 16px; cursor: pointer;
  margin-top: 15px; transition: 0.2s;
}
.btn:hover { opacity: 0.9; }
.table-responsive { overflow-x: auto; width: 100%; }
.table-responsive table { width: 100%; min-width: 800px; border-collapse: collapse; }
table, th, td { border: 1px solid #ddd; padding: 6px; font-size: 13px; text-align: center; }
th { background: var(--main-color, #0d6efd); color: white; }
.summary-container {
  background: #fff; padding: 15px; border-radius: 10px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.1);
  margin-top: 20px; max-height: 400px; overflow-y: auto;
}
.record {
  border: 1px solid #ddd;
  border-radius: 8px;
  padding: 10px 12px;
  margin-bottom: 12px;
  background: #fafbff;
}
.record h4 { margin: 0 0 5px; color: var(--main-color, #0d6efd); }
.record table th, .record table td {
  border: 1px solid #ddd; font-size: 12px; padding: 4px; text-align: center;
}
.delete-btn { background: #dc3545; color: white; border: none; padding: 4px 8px; border-radius: 6px; cursor: pointer; }
.delete-btn:hover { background: #b02a37; }
@media (max-width: 768px) {
  body { flex-direction: column; height: auto; }
  .sidebar { width: 100%; flex-direction: row; justify-content: space-around; padding: 10px 0; }
  .sidebar h2 { font-size: 18px; margin: 0; }
  .nav-item { padding: 10px; font-size: 14px; }
  .main { padding: 15px; }
  form { width: 100%; box-shadow: none; padding: 15px; border-radius: 0; }
  table, .record table { font-size: 11px; min-width: 700px; }
}
@media print { body { background: white; } .sidebar, .btn, .delete-btn, .settings { display: none; } .main { padding: 0; } .summary-container { max-height: none; overflow: visible; } }
</style>
</head>
<body>

<div class="sidebar">
  <h2>üì¶ Booking App</h2>
  <div class="nav-item active">New Booking</div>
  <div class="nav-item">Settings</div>
</div>

<div class="main">
<h1>Booking Form</h1>
<form id="bookingForm">
<label>Name of Account (MD/Patient):</label>
<input type="text" id="name" required>
<label>Contact Number:</label>
<input type="tel" id="contact" required>
<label>Delivery Option:</label>
<select id="delivery">
<option>Pick-Up (by client at office)</option>
<option>Delivery (by branch rider to client)</option>
<option selected>Pick-Up by Lalamove / Grab / Courier</option>
</select>
<label>Pick-Up / Delivery Address:</label>
<textarea id="address" rows="2"></textarea>
<label>Preferred Date & Time:</label>
<input type="date" id="date"> <input type="time" id="time">
<label>Payment Option:</label>
<select id="payment">
<option value="C.O.D">C.O.D (Cash on Delivery)</option>
<option value="Terms">Terms</option>
<option value="PDC">PDC (Post Dated Check)</option>
<option value="Bank">Deposited thru Bank</option>
</select>
<div id="termsDaysContainer" style="display:none;">
<label>Terms (Days):</label>
<input type="number" id="termsDays" min="1" placeholder="Enter number of days">
</div>
<div id="bankContainer" style="display:none;">
<label>Bank Name:</label>
<input type="text" id="bankName" placeholder="e.g. BPI, BDO, Metrobank">
</div>
<label>Order Details:</label>
<div class="table-responsive">
<table id="orderTable">
<thead>
<tr>
<th>Generic</th>
<th>Brand</th>
<th>Qty + Unit</th>
<th>SRP</th>
<th>Discount Type</th>
<th>Discount Value</th>
<th>Discount Amt</th>
<th>No Discount</th>
<th>Remarks</th>
<th>Total</th>
<th>üóë</th>
</tr>
</thead>
<tbody id="orderBody"></tbody>
</table>
</div>
<button type="button" class="btn" id="addRow">+ Add Item</button>
<label>Total Amount (‚Ç±):</label>
<input type="number" id="total" readonly>
<label>Distributor & Branch:</label>
<input type="text" id="distributor">
<label>Remarks / Special Instructions:</label>
<textarea id="remarks" rows="3"></textarea>
<button class="btn" type="submit">Save Booking</button>
</form>

<div class="settings" style="display:none; margin-top:20px; text-align:center;">
<label for="themeSelect" style="color:white;">Choose Theme:</label>
<select id="themeSelect" style="padding:5px; border-radius:5px;">
<option value="default">Blue (Default)</option>
<option value="black">Black</option>
<option value="red">Red</option>
<option value="yellow">Yellow</option>
</select>
</div>

<div class="summary-container" id="summaryContainer">
<h3>Saved Bookings</h3>
<div id="recordList"></div>
</div>

<!-- jsPDF + autoTable -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>

<script>
// === ELEMENT REFERENCES ===
const nameInput = document.getElementById('name');
const contactInput = document.getElementById('contact');
const deliveryInput = document.getElementById('delivery');
const addressInput = document.getElementById('address');
const dateInput = document.getElementById('date');
const timeInput = document.getElementById('time');
const distributorInput = document.getElementById('distributor');
const remarksInput = document.getElementById('remarks');

const addRowBtn = document.getElementById('addRow');
const orderBody = document.getElementById('orderBody');
const totalField = document.getElementById('total');
const form = document.getElementById('bookingForm');
const summary = document.getElementById('recordList');
const paymentSelect = document.getElementById('payment');
const termsDaysContainer = document.getElementById('termsDaysContainer');
const bankContainer = document.getElementById('bankContainer');
const termsDaysInput = document.getElementById('termsDays');
const bankNameInput = document.getElementById('bankName');
const navItems = document.querySelectorAll('.nav-item');
const settingsDiv = document.querySelector('.settings');
const themeSelect = document.getElementById('themeSelect');

// === PAYMENT TOGGLE ===
paymentSelect.addEventListener('change', () => {
termsDaysContainer.style.display = paymentSelect.value==='Terms'?'block':'none';
bankContainer.style.display = paymentSelect.value==='Bank'?'block':'none';
});

// === ADD ROW ===
function addRow() {
  const row = document.createElement('tr');
  row.innerHTML = `
    <td><input type="text" class="generic"></td>
    <td><input type="text" class="brand"></td>
    <td>
      <input type="number" class="qty" min="1" value="1" style="width:60px;">
      <select class="unit" style="width:70px;">
        <option value="pcs">Pcs</option>
        <option value="box">Box</option>
        <option value="pack">Pack</option>
        <option value="tabs">Tabs</option>
      </select>
    </td>
    <td><input type="number" class="srp" min="0" value="0"></td>
    <td>
      <select class="discountType">
        <option value="percent">%</option>
        <option value="amount">Fixed Amount</option>
        <option value="nodisc">No Discount</option>
      </select>
    </td>
    <td><input type="number" class="discount" min="0" value="0"></td>
    <td><input type="number" class="discountAmt" readonly></td>
    <td><input type="number" class="nodisc" readonly></td>
    <td><input type="text" class="remarksItem"></td>
    <td><input type="number" class="total" readonly></td>
    <td><button type="button" class="deleteRow">‚ùå</button></td>`;
  orderBody.appendChild(row);
  updateTotals();
}

// === UPDATE TOTALS ===
function updateTotals() {
  let grandTotal=0;
  document.querySelectorAll('#orderBody tr').forEach(row=>{
    const qty = parseFloat(row.querySelector('.qty').value)||0;
    const srp = parseFloat(row.querySelector('.srp').value)||0;
    const discountType = row.querySelector('.discountType').value;
    const discount = parseFloat(row.querySelector('.discount').value)||0;
    const noDisc = srp*qty;
    let discAmt=0,total=noDisc;
    if(discountType==='percent'){discAmt=noDisc*discount/100; total=noDisc-discAmt;}
    else if(discountType==='amount'){discAmt=discount; total=noDisc-discAmt;}
    row.querySelector('.discountAmt').value=discAmt.toFixed(2);
    row.querySelector('.nodisc').value=noDisc.toFixed(2);
    row.querySelector('.total').value=total.toFixed(2);
    grandTotal+=total;
  });
  totalField.value=grandTotal.toFixed(2);
}

orderBody.addEventListener('input', e=>{
  if(['qty','srp','discount','discountType'].includes(e.target.className)) updateTotals();
});
orderBody.addEventListener('click', e=>{
  if(e.target.classList.contains('deleteRow')){e.target.closest('tr').remove();updateTotals();}
});
addRowBtn.addEventListener('click', addRow);

// === NAVIGATION & SETTINGS ===
navItems.forEach(item=>{
item.addEventListener('click', ()=>{
navItems.forEach(i=>i.classList.remove('active'));
item.classList.add('active');
settingsDiv.style.display = item.textContent.trim()==='Settings'?'block':'none';
});
});
themeSelect.addEventListener('change', ()=>{
const theme=themeSelect.value;
if(theme==='default'){document.documentElement.style.setProperty('--sidebar-color','#0d6efd');document.documentElement.style.setProperty('--main-color','#0d6efd');document.documentElement.style.setProperty('--btn-color','#0d6efd');}
else if(theme==='black'){document.documentElement.style.setProperty('--sidebar-color','#333');document.documentElement.style.setProperty('--main-color','#000');document.documentElement.style.setProperty('--btn-color','#555');}
else if(theme==='red'){document.documentElement.style.setProperty('--sidebar-color','#dc3545');document.documentElement.style.setProperty('--main-color','#b02a37');document.documentElement.style.setProperty('--btn-color','#dc3545');}
else if(theme==='yellow'){document.documentElement.style.setProperty('--sidebar-color','#ffc107');document.documentElement.style.setProperty('--main-color','#e0a800');document.documentElement.style.setProperty('--btn-color','#ffc107');}
});

// === SAVE BOOKING ===
form.addEventListener('submit', e=>{
e.preventDefault();
const items=[];
document.querySelectorAll('#orderBody tr').forEach(row=>{
items.push({
generic: row.querySelector('.generic').value,
brand: row.querySelector('.brand').value,
qty: row.querySelector('.qty').value,
unit: row.querySelector('.unit').value,
srp: row.querySelector('.srp').value,
discountType: row.querySelector('.discountType').value,
discount: row.querySelector('.discount').value,
total: row.querySelector('.total').value,
remarks: row.querySelector('.remarksItem').value
});
});
let paymentType = paymentSelect.value;
if(paymentType==='Terms') paymentType+=` (${termsDaysInput.value} days)`;
if(paymentType==='Bank') paymentType+=` - ${bankNameInput.value}`;
const record={
name:nameInput.value,
contact:contactInput.value,
delivery:deliveryInput.value,
address:addressInput.value,
date:dateInput.value,
time:timeInput.value,
payment:paymentType,
distributor:distributorInput.value,
remarks:remarksInput.value,
total:totalField.value,
items,
details:JSON.stringify(items,null,2)
};
const records=JSON.parse(localStorage.getItem('bookings'))||[];
records.push(record);
localStorage.setItem('bookings',JSON.stringify(records));
loadRecords();
form.reset();
orderBody.innerHTML='';
totalField.value='';
termsDaysContainer.style.display='none';
bankContainer.style.display='none';
});

// === LOAD RECORDS ===
function loadRecords(){
const records=JSON.parse(localStorage.getItem('bookings'))||[];
summary.innerHTML='';
records.forEach((rec,index)=>{
const div=document.createElement('div');
div.classList.add('record');
div.innerHTML=`<h4>${rec.name} - ‚Ç±${rec.total}</h4>
üìû ${rec.contact}<br>
üöö ${rec.delivery}<br>
üí≥ ${rec.payment}<br>
üè¢ ${rec.distributor}<br>
üìç ${rec.address || 'N/A'}<br>
<p>Remarks: ${rec.remarks || 'None'}</p>
<button class="delete-btn" onclick="deleteRecord(${index})">Delete</button>
<button class="btn" style="margin-top:5px;" onclick="downloadPDF(${index})">üìÑ Export PDF</button>
<details style="margin-top:5px;"><summary>View Details</summary>
<table>
<thead><tr>
<th>Generic</th><th>Brand</th><th>Qty</th><th>Unit</th><th>SRP</th><th>Discount Type</th><th>Discount Value</th><th>Discount Amt</th><th>Total</th><th>Remarks</th></tr></thead>
<tbody>
${rec.items.map(item=>`<tr>
<td>${item.generic}</td>
<td>${item.brand}</td>
<td>${item.qty}</td>
<td>${item.unit}</td>
<td>${item.srp}</td>
<td>${item.discountType}</td>
<td>${item.discount}</td>
<td>${item.discountType==='percent'? (item.srp*item.qty*(item.discount/100)).toFixed(2) : item.discountType==='amount'? parseFloat(item.discount).toFixed(2) : 0}</td>
<td>${item.total}</td>
<td>${item.remarks}</td>
</tr>`).join('')}
</tbody>
</table>
</details>`;
summary.appendChild(div);
});
}

// === DELETE RECORD ===
function deleteRecord(index){
const records=JSON.parse(localStorage.getItem('bookings'))||[];
records.splice(index,1);
localStorage.setItem('bookings',JSON.stringify(records));
loadRecords();
}

// === DOWNLOAD PDF PER TRANSACTION ===
function downloadPDF(index){
const records=JSON.parse(localStorage.getItem('bookings'))||[];
const rec=records[index];
const { jsPDF } = window.jspdf;
const doc = new jsPDF();
let y=20;
doc.setFontSize(14);
doc.text(`Booking for ${rec.name}`,20,y); y+=10;
doc.setFontSize(11);
doc.text(`Contact: ${rec.contact}`,20,y); y+=6;
doc.text(`Delivery: ${rec.delivery}`,20,y); y+=6;
doc.text(`Address: ${rec.address || 'N/A'}`,20,y); y+=6;
doc.text(`Date: ${rec.date} ${rec.time}`,20,y); y+=6;
doc.text(`Payment: ${rec.payment}`,20,y); y+=6;
doc.text(`Distributor: ${rec.distributor}`,20,y); y+=6;
doc.text(`Remarks: ${rec.remarks || 'None'}`,20,y); y+=10;

// Table
const tableData = rec.items.map(item=>[
item.generic,item.brand,item.qty,item.unit,item.srp,item.discountType,item.discount,
(item.discountType==='percent'? (item.srp*item.qty*(item.discount/100)).toFixed(2) : item.discountType==='amount'? parseFloat(item.discount).toFixed(2) : 0),
item.total,item.remarks
]);
doc.autoTable({
head:[['Generic','Brand','Qty','Unit','SRP','Discount Type','Discount Value','Discount Amt','Total','Remarks']],
body:tableData,
startY:y
});
y=doc.lastAutoTable.finalY+10;
doc.text(`Total Amount: ‚Ç±${rec.total}`,140,y);
doc.save(`Booking_${rec.name}_${rec.date}.pdf`);
}

loadRecords();
</script>

</div>
</body>
</html>
