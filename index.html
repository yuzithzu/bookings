<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Product & Materials Calculator</title>
  <style>
    :root{
      --bg:#0b1220;
      --card:#0f1724;
      --muted:#94a3b8;
      --accent:#6ee7b7;
      --glass: rgba(255,255,255,0.03);
      --glass-2: rgba(255,255,255,0.02);
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:Inter,ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;
      background: linear-gradient(180deg,#071024 0%, #071032 100%);
      color:#e6eef8;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }

    .wrap{max-width:1150px;margin:28px auto;padding:20px;}
    header{display:flex;align-items:center;gap:12px;margin-bottom:20px}
    header h1{margin:0;font-size:20px;color:var(--accent)}
    header .muted{color:var(--muted)}

    .grid{display:grid;grid-template-columns:1fr 1fr;gap:20px}
    @media (max-width:900px){.grid{grid-template-columns:1fr}}

    .card{
      background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border-radius:12px;padding:16px;border:1px solid rgba(255,255,255,0.03);
      box-shadow:0 8px 22px rgba(2,6,23,0.6);
    }
    h2{margin:0 0 10px 0;color:var(--accent);font-size:16px}
    .muted{color:var(--muted);font-size:13px}

    /* product manager */
    .controls{display:flex;flex-wrap:wrap;gap:8px}
    .controls input[type=text], .controls input[type=number], .controls button{
      padding:9px 10px;border-radius:10px;background:transparent;border:1px solid rgba(255,255,255,0.06);color:inherit;
    }
    .btn{background:linear-gradient(90deg,var(--accent), #3dd6b6); border:none; padding:9px 12px; border-radius:10px; color:#042018; font-weight:700; cursor:pointer}
    .btn.ghost{background:transparent;color:var(--accent);border:1px solid rgba(255,255,255,0.04)}
    .small{padding:7px 9px;font-size:14px}

    .list{margin-top:12px;max-height:220px;overflow:auto;padding-right:6px}
    .item{display:flex;gap:10px;align-items:center;padding:10px;border-radius:10px;margin-bottom:8px;background:var(--glass);}
    .item .title{flex:1}
    .price{font-weight:700}

    /* calculator */
    .table-head{display:flex;gap:8px;align-items:center;color:var(--muted);font-size:13px;padding:6px 4px 0 4px}
    .table-head div{flex-basis:0;flex-grow:1}
    .table-head .col-small{flex-basis:90px;flex-grow:0}
    .rows{max-height:360px;overflow:auto;margin-top:10px}
    .calc-row{display:flex;gap:8px;align-items:center;padding:10px;border-radius:10px;margin-bottom:8px;background:var(--glass)}
    .calc-row select, .calc-row input{background:transparent;border:1px solid rgba(255,255,255,0.04);padding:8px;border-radius:8px;color:inherit}
    .calc-row .col-material{width:34%}
    .calc-row .col-pcs{width:10%}
    .calc-row .col-desc{width:30%}
    .calc-row .col-price{width:12%}
    .calc-row .col-per{width:12%;font-weight:700}

    .row-actions{display:flex;gap:8px}
    .row-actions button{padding:7px 9px;border-radius:8px;font-size:13px;border:1px solid rgba(255,255,255,0.03);background:transparent;color:var(--accent);cursor:pointer}

    .bottom{display:flex;gap:12px;align-items:center;justify-content:space-between;margin-top:12px}
    .calc-summary{min-width:220px;background:var(--glass-2);padding:12px;border-radius:10px}
    .calc-row small{display:block;color:var(--muted);font-size:12px;margin-top:4px}

    .markup-section{background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005));border-radius:10px;padding:12px;border:1px solid rgba(255,255,255,0.02)}
    .markup-item{padding:8px 0;border-bottom:1px solid rgba(255,255,255,0.03)}
    .markup-item:last-child{border-bottom:none}
    .muted-sm{color:var(--muted);font-size:13px}

    footer{margin-top:22px;text-align:center;color:var(--muted);font-size:13px}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <h1>ðŸ›’ Product Manager & Materials Calculator</h1>
        <div class="muted">Add products â†’ use them in materials rows â†’ per-sheet markup computations</div>
      </div>
      <div style="margin-left:auto" class="muted">Autosave: LocalStorage</div>
    </header>

    <div class="grid">
      <!-- Product Manager -->
      <section class="card">
        <h2>Product Manager</h2>
        <p class="muted">Add or update products. Prices saved to browser.</p>

        <div style="margin-top:12px" class="controls">
          <input id="productName" type="text" placeholder="Product name (e.g. girl)" />
          <input id="productPrice" type="number" step="0.01" placeholder="Price (â‚±)" />
          <button id="addUpdateBtn" class="btn small">Add / Update</button>
          <button id="clearAllBtn" class="btn ghost small">Clear All</button>
        </div>

        <div style="margin-top:12px; display:flex; gap:8px; align-items:center">
          <button id="deleteSelectedBtn" class="btn small ghost">Delete Selected</button>
          <div style="margin-left:auto" class="muted-sm">Total products: <span id="totalCount">0</span></div>
        </div>

        <div class="list" id="productList" aria-live="polite"></div>
      </section>

      <!-- Materials Calculator -->
      <section class="card">
        <h2>Materials Calculator</h2>
        <p class="muted">Enter materials rows â€” Per Sheet is Price Ã· PCS. Markup uses Per Sheet.</p>

        <div class="table-head" aria-hidden="true">
          <div class="col-material">Materials</div>
          <div class="col-pcs">Pcs</div>
          <div class="col-desc">Description</div>
          <div class="col-price">Price</div>
          <div class="col-per">Per Sheet</div>
          <div style="width:120px"></div>
        </div>

        <div class="rows" id="rowsContainer"></div>

        <div style="margin-top:10px; display:flex; gap:8px; align-items:center">
          <button id="addRowBtn" class="btn small">+ Add Row</button>

          <div style="margin-left:auto; display:flex; gap:12px; align-items:center; flex-wrap:wrap;">
            <label class="muted-sm">Tax %:
              <input id="taxPercent" type="number" step="0.01" value="0" style="width:80px;margin-left:6px" />
            </label>

            <div class="calc-summary" style="min-width:180px">
              <div class="muted-sm">Total Materials</div>
              <div style="font-weight:700; font-size:18px">â‚± <span id="materialsTotal">0.00</span></div>
              <div class="muted-sm" style="margin-top:6px">Tax (â‚±)</div>
              <div style="font-weight:700; font-size:16px">â‚± <span id="taxAmount">0.00</span></div>
              <div class="muted-sm" style="margin-top:8px">Total + Tax</div>
              <div style="font-weight:700; font-size:14px">â‚± <span id="totalWithTax">0.00</span></div>
            </div>
          </div>
        </div>

        <div class="markup-section" style="margin-top:12px">
          <div class="muted-sm">Markup Computations (based on Per Sheet)</div>
          <div id="markupContainer" style="margin-top:8px"></div>
        </div>
      </section>
    </div>

    <footer>Built responsive Â· LocalStorage autosave Â· PCS default is blank</footer>
  </div>

  <script>
    // Formatter
    const fmt = (n) => Number(n || 0).toLocaleString(undefined, {minimumFractionDigits:2, maximumFractionDigits:2});

    // Elements - Products
    const productName = document.getElementById('productName');
    const productPrice = document.getElementById('productPrice');
    const addUpdateBtn = document.getElementById('addUpdateBtn');
    const clearAllBtn = document.getElementById('clearAllBtn');
    const deleteSelectedBtn = document.getElementById('deleteSelectedBtn');
    const productList = document.getElementById('productList');
    const totalCount = document.getElementById('totalCount');

    // Elements - Materials
    const rowsContainer = document.getElementById('rowsContainer');
    const addRowBtn = document.getElementById('addRowBtn');
    const taxPercentInput = document.getElementById('taxPercent');
    const materialsTotalEl = document.getElementById('materialsTotal');
    const taxAmountEl = document.getElementById('taxAmount');
    const totalWithTaxEl = document.getElementById('totalWithTax');
    const markupContainer = document.getElementById('markupContainer');

    // Storage keys
    const PRODUCTS_KEY = 'pm_products_v1';
    const ROWS_KEY = 'pm_materials_v1';

    // State
    let products = JSON.parse(localStorage.getItem(PRODUCTS_KEY) || '[]');
    let rows = JSON.parse(localStorage.getItem(ROWS_KEY) || '[]');

    // Utilities
    function escapeHtml(s){
      return String(s||'').replace(/[&<>\"']/g, c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]));
    }

    // Save/Render products
    function saveProducts(){
      localStorage.setItem(PRODUCTS_KEY, JSON.stringify(products));
      renderProducts();
      renderRows(); // update dropdowns if products changed
      computeAll();
    }

    function renderProducts(){
      productList.innerHTML = '';
      products.forEach((p, idx) => {
        const el = document.createElement('div');
        el.className = 'item';
        el.innerHTML = `
          <input type="checkbox" data-index="${idx}" />
          <div class="title">
            <div style="font-weight:700">${escapeHtml(p.name)}</div>
            <div class="muted-sm">â‚± ${fmt(p.price)}</div>
          </div>
          <div style="margin-left:8px; display:flex;flex-direction:column;gap:6px">
            <button class="btn ghost small" data-edit="${idx}">Edit</button>
          </div>
        `;
        productList.appendChild(el);
      });
      totalCount.textContent = products.length;

      // edit handlers
      productList.querySelectorAll('[data-edit]').forEach(btn=>{
        btn.addEventListener('click', ()=>{
          const i = Number(btn.getAttribute('data-edit'));
          productName.value = products[i].name;
          productPrice.value = products[i].price;
          addUpdateBtn.dataset.editIndex = i;
          addUpdateBtn.textContent = 'Update';
        });
      });
    }

    addUpdateBtn.addEventListener('click', ()=>{
      const name = productName.value.trim();
      const price = parseFloat(productPrice.value) || 0;
      if(!name){ alert('Enter product name'); return; }
      if(addUpdateBtn.dataset.editIndex !== undefined){
        const idx = Number(addUpdateBtn.dataset.editIndex);
        products[idx] = { name, price };
        delete addUpdateBtn.dataset.editIndex;
        addUpdateBtn.textContent = 'Add / Update';
      } else {
        products.push({ name, price });
      }
      productName.value = '';
      productPrice.value = '';
      saveProducts();
    });

    deleteSelectedBtn && deleteSelectedBtn.addEventListener('click', ()=>{
      const boxes = Array.from(productList.querySelectorAll('input[type=checkbox]'));
      const removeIdx = boxes.filter(b=>b.checked).map(b=>Number(b.dataset.index)).sort((a,b)=>b-a);
      if(removeIdx.length===0){ alert('No selection'); return; }
      for(const i of removeIdx) products.splice(i,1);
      saveProducts();
    });

    clearAllBtn.addEventListener('click', ()=>{
      if(confirm('Clear all products?')){
        products = [];
        saveProducts();
      }
    });

    // Per-sheet computation
    function computePerSheet(price, pcs){
      const p = Number(price) || 0;
      const q = Number(pcs);
      if(!q || q <= 0) return 0;
      return p / q;
    }

    // Save rows
    function saveRows(){
      localStorage.setItem(ROWS_KEY, JSON.stringify(rows));
      computeAll();
    }

    // Render rows
    function renderRows(){
      rowsContainer.innerHTML = '';
      rows.forEach((r, i) => {
        const row = document.createElement('div');
        row.className = 'calc-row';
        let options = '<option value="">Select product</option>';
        products.forEach((p, idx)=> {
          options += `<option value="${idx}" ${r.materialId===idx?'selected':''}>${escapeHtml(p.name)}</option>`;
        });

        row.innerHTML = `
          <select class="col-material" data-i="${i}">${options}</select>
          <input class="col-pcs" data-i="${i}" type="number" min="0" placeholder="PCS" value="${r.pcs===undefined||r.pcs===''? '': r.pcs}" />
          <input class="col-desc" data-i="${i}" type="text" placeholder="description" value="${escapeHtml(r.desc||'')}" />
          <input class="col-price" data-i="${i}" type="number" step="0.01" placeholder="Price" value="${r.price||0}" />
          <div class="col-per">â‚± <span class="per">${fmt(computePerSheet(r.price, r.pcs))}</span></div>
          <div class="row-actions">
            <button data-save="${i}" title="Save">Save</button>
            <button data-delete="${i}" title="Delete">Delete</button>
          </div>
        `;
        rowsContainer.appendChild(row);
      });

      // Attach handlers after DOM created

      // Save per-row
      rowsContainer.querySelectorAll('[data-save]').forEach(btn=>{
        btn.addEventListener('click', ()=>{
          const i = Number(btn.getAttribute('data-save'));
          const container = btn.closest('.calc-row');
          const matSel = container.querySelector('select').value;
          const pcsVal = container.querySelector('.col-pcs').value;
          const descVal = container.querySelector('.col-desc').value.trim();
          const priceVal = Number(container.querySelector('.col-price').value) || 0;

          rows[i].pcs = pcsVal === '' ? '' : Number(pcsVal);
          rows[i].desc = descVal;
          rows[i].price = priceVal;
          rows[i].materialId = matSel === '' ? null : Number(matSel);
          rows[i].name = (rows[i].materialId != null && products[rows[i].materialId]) ? products[rows[i].materialId].name : (rows[i].name || '');
          // If product selected, override price with product price
          if(rows[i].materialId != null && products[rows[i].materialId]){
            rows[i].price = products[rows[i].materialId].price;
          }
          saveRows();
          renderRows(); // re-render to reflect possible autofill
        });
      });

      // Delete per-row
      rowsContainer.querySelectorAll('[data-delete]').forEach(btn=>{
        btn.addEventListener('click', ()=>{
          const i = Number(btn.getAttribute('data-delete'));
          if(confirm('Delete this material row?')){
            rows.splice(i,1);
            saveRows();
            renderRows();
          }
        });
      });

      // Material select change -> autofill name & price and save
      rowsContainer.querySelectorAll('select').forEach(sel=>{
        sel.addEventListener('change', (e)=>{
          const idx = Number(sel.dataset.i);
          const val = sel.value;
          if(val !== ''){
            rows[idx].materialId = Number(val);
            rows[idx].name = products[val].name;
            rows[idx].price = products[val].price;
          } else {
            rows[idx].materialId = null;
            rows[idx].name = '';
            rows[idx].price = 0;
          }
          saveRows();
          renderRows();
        });
      });

      // Live per-sheet update on pcs/price input
      rowsContainer.querySelectorAll('.col-pcs, .col-price').forEach(inp=>{
        inp.addEventListener('input', (e)=>{
          const container = e.target.closest('.calc-row');
          const priceVal = Number(container.querySelector('.col-price').value) || 0;
          const pcsVal = container.querySelector('.col-pcs').value;
          const perEl = container.querySelector('.per');
          if(perEl) perEl.textContent = fmt(computePerSheet(priceVal, pcsVal));
        });
      });
    }

    // Compute totals and markups
    function computeAll(){
      let total = 0;
      rows.forEach((r, i)=>{
        total += Number(r.price || 0);
        const per = computePerSheet(r.price, r.pcs);
        const el = rowsContainer.querySelectorAll('.per')[i];
        if(el) el.textContent = fmt(per);
      });

      const taxPercent = Number(taxPercentInput.value) || 0;
      const taxAmount = (total * taxPercent) / 100;
      materialsTotalEl.textContent = fmt(total);
      taxAmountEl.textContent = fmt(taxAmount);
      totalWithTaxEl.textContent = fmt(total + taxAmount);

      computeMarkupForAll();
    }

    // Markup computations use Per Sheet value
    function computeMarkupForAll(){
      markupContainer.innerHTML = '';
      if(rows.length === 0){
        markupContainer.innerHTML = '<div class="muted-sm">No rows to compute</div>';
        return;
      }
      rows.forEach((r, i)=>{
        const perSheet = computePerSheet(r.price, r.pcs);
        const m10 = perSheet * 1.10;
        const m20 = perSheet * 1.20;
        const m30 = perSheet * 1.30;
        const div = document.createElement('div');
        div.className = 'markup-item';
        div.innerHTML = `
          <div style="display:flex;justify-content:space-between;align-items:center">
            <div><strong>Row ${i+1}:</strong> ${escapeHtml(r.name || '(no name)')}</div>
            <div class="muted-sm">Per sheet: â‚± ${fmt(perSheet)}</div>
          </div>
          <div style="margin-top:6px">
            <div>10% â†’ â‚± ${fmt(m10)}</div>
            <div>20% â†’ â‚± ${fmt(m20)}</div>
            <div>30% â†’ â‚± ${fmt(m30)}</div>
          </div>
        `;
        markupContainer.appendChild(div);
      });
    }

    // Add row
    addRowBtn.addEventListener('click', ()=>{
      rows.push({ name:'', pcs:'', desc:'', price:0, materialId:null });
      renderRows();
      saveRows();
    });

    // Tax percent change
    taxPercentInput.addEventListener('input', computeAll);

    // Initialize arrays if invalid
    if(!Array.isArray(products)) products = [];
    if(!Array.isArray(rows)) rows = [];

    // Initial render
    renderProducts();
    renderRows();
    computeAll();
  </script>
</body>
</html>
